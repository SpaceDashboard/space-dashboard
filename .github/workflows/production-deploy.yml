name: Production Deploy

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version/tag to deploy (e.g., v2.0.2) or "latest" for most recent release'
        required: false
        default: 'latest'

permissions:
  contents: read
  packages: read
  actions: write
  deployments: write
  id-token: write

concurrency:
  group: production-deploy-${{ github.ref }}
  cancel-in-progress: false

jobs:
  deploy:
    name: Deploy to Production
    uses: ./.github/workflows/deploy.yml
    with:
      environment: Production
      version: ${{ github.event.inputs.version || 'latest' }}
    secrets:
      GH_PR_CREATE: ${{ secrets.GH_PR_CREATE }}
      SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}
      FTP_SERVER: ${{ secrets.FTP_SERVER }}
      PROD_FTP_USERNAME: ${{ secrets.PROD_FTP_USERNAME }}
      PROD_FTP_PASSWORD: ${{ secrets.PROD_FTP_PASSWORD }}
      # These are included to satisfy the workflow call requirements
      STAGING_FTP_USERNAME: ''
      STAGING_FTP_PASSWORD: ''
      CLOUDFLARE_PURGE_CACHE_URL: ${{ secrets.CLOUDFLARE_PURGE_CACHE_URL }}
      CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_TOKEN }}
